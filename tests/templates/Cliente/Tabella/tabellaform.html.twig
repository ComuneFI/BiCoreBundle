{% set isnew = (entity.id is defined and entity.id != 0) ? false : true %}
{% set pathform = isnew ? path(nomecontroller|getparametrotabella ~ '_new') : path(nomecontroller|getparametrotabella ~ '_update', { 'id': entity.id }) %}
{% set form = (edit_form is defined )?edit_form:form  %}

{{ form_start(form,
                {'id': 'formdati'~nomecontroller|getparametrotabella,
                 'name': 'formdati'~nomecontroller|getparametrotabella, 
                 'method': 'POST', 
                 'action': pathform,
                 'attr': {'class': 'bitabellaform'}
                })
}}

<div class="form-row">
    <div class="form-group col-md-2">
        {{ form_row(form.nominativo) }}
    </div>
    <div class="form-group col-md-2">
        {{ form_row(form.datanascita) }}
    </div>        
    <div class="form-group col-md-2">
        {{ form_row(form.punti) }}
    </div>
    <div class="form-group col-md-2">
        {{ form_row(form.iscrittoil) }}
    </div>
    <!--Se uno vuole forzare ad andare a capo calcola quanto manca per arrivare a 12-->
    <!--<div class="form-group col-md-4"></div>-->
    <div class="form-group col-md-2">
        {{ form_row(form.creditoresiduo) }}
    </div>
    <div class="form-group col-md-2">
        {{ form_row(form.attivo) }}
    </div>

    <div class="form-group col-md-12">
        {{ form_row(form.note) }}
    </div>
</div>

<div class="clearfix">
    <div class="float-lg-right">
        {{ form_widget(form.submit) }}
        {%if not isnew %}
            <button class="btn btn-outline-primary" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                Registro modifiche
            </button>
        {%endif %}
    </div>
</div>
{{ form_end(form) }}

{%if not isnew %}
    <!--Attenzione a questo div che deve contenere tutte queste informazioni, altrimenti nella edit si raddoppiano 
    i div ogni chiamata ad una nuova edit -->
    <div id="{{nomecontroller|getparametrotabella}}SubTabellaDettagliContainer">
        <div class="collapse" id="collapseExample">
            <div class="card card-body">
                {% for modifica in elencomodifiche %}
                    <li>{{modifica.giorno|date("d/m/Y H:i:s")}} modificato {{modifica.nomecampo|e}} da {{ modifica.operatori.username|e }}, prima era: {{modifica.valoreprecedente|e}} </li>
                    {% endfor %}
            </div>
        </div>
        <ul class="nav nav-tabs nav-tabs-cards" id="card-simple" role="tablist">
            <li class="nav-item"><a class="nav-link active" id="card-simple1-tab" data-toggle="tab" href="#card-simpletab1" role="tab" aria-controls="card-simpletab1" aria-selected="true">Ordini</a></li>
            <li class="nav-item"><a class="nav-link" id="card-simple2-tab" data-toggle="tab" href="#card-simpletab2" role="tab" aria-controls="card-simpletab2" aria-selected="false">Magazzino</a></li>
            <li class="nav-item-filler"></li>
        </ul>
        <div class="tab-content" id="card-simpleContent">
            <div class="tab-pane p-4 fade show active" id="card-simpletab1" role="tabpanel" aria-labelledby="card-simple1-tab">
                <!-- Tabella ordini -->
                <div id="tabellaOrdineCliente"></div>
            </div>
            <div class="tab-pane p-4 fade" id="card-simpletab2" role="tabpanel" aria-labelledby="card-simple2-tab">
                <div id="tabellaMagazzinoCliente"></div>
            </div>
        </div>

        <script type="text/javascript">
            var url = '{{path("Ordine_indexdettaglio")}}';
            var data = {
            prefiltri: [{nomecampo: "Ordine.Cliente.id", operatore: "=", valore: {{entity.id}}}],
                    titolotabella: 'Ordini del cliente {{entity.nominativo}}',
                    modellocolonne: [{nomecampo: 'Ordine.Cliente', escluso: true}],
                    colonneordinamento: {'Ordine.data': 'DESC', 'Ordine.quantita': 'DESC'},
                    multiselezione: true
            };
            $.ajax({
            type: 'POST',
                    url: url,
                    data: {parametripassati: JSON.stringify(data)}
            }).done(function (data) {
            $("#tabellaOrdineCliente").html(data);
            });
        </script>
        <script type="text/javascript">
            var url = '{{path("Magazzino_indexdettaglio")}}';
            var data = {
            prefiltri: [{nomecampo: "Magazzino.Ordine.Cliente.id", operatore: "=", valore: {{entity.id}}}],
                    modellocolonne: [{nomecampo: 'Magazzino.giornodellasettimana', escluso: false, decodifiche: ["Domenica", "Lunedì", "Martedì", "Mercoledì", "Giovedì", "Venerdì", "Sabato"]}],
                    titolotabella: 'Roba in magazzino del cliente {{entity.nominativo}}'};
            $.ajax({
            type: 'POST',
                    url: url,
                    data: {parametripassati: JSON.stringify(data)}
            }).done(function (data) {
            $("#tabellaMagazzinoCliente").html(data);
            });
        </script>
    </div>
{%endif %}